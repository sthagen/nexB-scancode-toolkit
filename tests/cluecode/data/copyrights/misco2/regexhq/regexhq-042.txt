Adapted from bzip2.js, copyright 2011 Kevin Kwok (antimatter15@gmail.com).